<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Refuel Assist v5.2 SAFE</title>
    <style>
        :root { 
            --primary: #38bdf8; --success: #22c55e; --warning: #fbbf24; --error: #ef4444; 
            --bg: #0f172a; --card-bg: #1e293b; --density-clr: #a855f7; --temp-clr: #10b981;
            --amber: #f59e0b;
            --header-h: 58px;
        }
        body { font-family: -apple-system, system-ui, sans-serif; background-color: var(--bg); color: white; margin: 0; display: flex; justify-content: center; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .page { display: none; width: 100%; max-width: 420px; padding: 12px; box-sizing: border-box; animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- LOGO STYLES --- */
        .brand-svg-container { width: 120px; height: 120px; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; }
        .brand-svg-container svg { width: 100%; height: 100%; }
        .brand-svg-container path, .mini-svg-container path { fill: var(--primary) !important; }
        .mini-svg-container { width: 24px; height: 24px; display: flex; align-items: center; }
        .mini-svg-container svg { width: 100%; height: 100%; }

        /* --- BA≈ûLIK --- */
        .top-navigation-row { display: flex; align-items: center; width: 100%; gap: 10px; margin-bottom: 8px; }
        .app-logo-indie { width: var(--header-h); height: var(--header-h); flex-shrink: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .app-logo-indie svg { width: 100%; height: 100%; }
        .expanded-capsule { display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(30, 41, 59, 0.7); height: var(--header-h); border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); flex-grow: 1; padding: 0 8px; }
        .model-inner { display: flex; align-items: center; gap: 8px; margin-bottom: 2px; }
        .model-name { font-size: 14px; font-weight: 800; letter-spacing: 0.5px; text-transform: uppercase; color: #f1f5f9; }
        .change-model-btn { font-size: 9px; font-weight: 800; color: var(--primary); text-transform: uppercase; background: rgba(56, 189, 248, 0.08); border: 1px solid rgba(56, 189, 248, 0.2); border-radius: 6px; padding: 2px 10px; cursor: pointer; display: flex; align-items: center; gap: 4px; }
        .change-model-btn::after { content: '‚ñæ'; }

        /* --- AKSƒ∞YON BUTONLARI --- */
        .action-row { display: flex; justify-content: space-between; width: 100%; margin-bottom: 12px; gap: 8px; }
        .reset-btn-amber { background: rgba(245, 158, 11, 0.1); border: 1px solid var(--amber); color: var(--amber); padding: 8px 16px; border-radius: 12px; font-size: 11px; font-weight: 900; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; flex-shrink: 0; }
        .warning-btn { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--error); color: var(--error); padding: 8px 12px; border-radius: 12px; font-size: 10px; font-weight: 900; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; justify-content: center; gap: 8px; flex-grow: 1; }

        /* --- Gƒ∞Rƒ∞≈û SAYFASI --- */
        #entry-page { flex-direction: column; align-items: center; justify-content: center; height: 98vh; background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%); }
        .hero-section { text-align: center; margin-bottom: 40px; }
        .logo-text { font-size: 34px; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 10px; }
        .logo-text .bold { font-weight: 900; letter-spacing: -1px; }
        .logo-text .light { font-weight: 200; color: var(--primary); letter-spacing: 4px; }
        .logo-subtitle { font-size: 11px; font-weight: 700; color: #64748b; letter-spacing: 3px; text-transform: uppercase; margin-top: 5px; }
        .logo-line { height: 1px; width: 180px; background: linear-gradient(90deg, transparent, var(--primary), transparent); margin: 20px auto; opacity: 0.3; }
        .fleet-container { width: 100%; display: flex; flex-direction: column; gap: 15px; }
        .fleet-card { background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.08); width: 100%; padding: 22px; border-radius: 24px; cursor: pointer; display: flex; align-items: center; gap: 20px; transition: transform 0.2s, background 0.2s; box-sizing: border-box; }
        .fleet-card:active { transform: scale(0.98); background: rgba(56, 189, 248, 0.1); border-color: var(--primary); }
        .fleet-info { flex-grow: 1; }
        .fleet-card h2 { margin: 0; font-size: 18px; font-weight: 800; color: #fff; }
        .fleet-card .limits { margin-top: 4px; font-size: 9px; color: #94a3b8; font-weight: 600; letter-spacing: 0.5px; }
        .fleet-card .max-val { margin-top: 6px; font-size: 11px; color: var(--primary); font-weight: 800; }

        /* --- HESAPLAMA ELEMENTLERƒ∞ --- */
        .card { background: var(--card-bg); padding: 12px; border-radius: 26px; border: 1px solid #334155; }
        .input-group { background: #111827; padding: 12px; border-radius: 22px; border: 2.5px solid transparent; margin-bottom: 10px; }
        #sec_block { border-color: var(--primary); }
        #sec_actual { border-color: var(--warning); }
        .group-label { font-size: 10px; font-weight: 800; color: #64748b; text-transform: uppercase; margin-bottom: 6px; display: block; text-align: center; }
        .main-input { background: #0f172a; border: 1px solid #334155; color: white; text-align: center; border-radius: 16px; font-size: 26px; width: 100%; height: 52px; font-weight: 700; outline: none; }
        .btn-step { background: #075985; border: none; color: white; width: 52px; height: 52px; border-radius: 16px; font-size: 26px; }
        .tank-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 10px; }
        .tank-box { background: #1e293b; padding: 10px 5px; border-radius: 18px; border: 1px solid #334155; text-align: center; }
        .tank-input { width: 100%; background: transparent; border: none; color: white; text-align: center; font-size: 18px; font-weight: 700; outline: none; }
        .btn-mini { background: #334155; border: none; color: white; width: 30px; height: 30px; border-radius: 10px; font-size: 18px; }
        .dashboard { background: #0f172a; border-radius: 24px; border: 3px solid var(--success); padding: 12px; margin-top: 10px; }
        .tgt-val { font-size: 20px; font-weight: 800; color: var(--success); margin: 6px 0; }
        .uplift-container { background: #111827; border-radius: 20px; border-top: 5px solid var(--warning); margin-top: 10px; padding: 15px 0; text-align: center; }
        .val-num { font-size: 28px; font-weight: 900; }
        
        .save-btn { width: 100%; background: var(--success); border: none; color: white; padding: 20px; border-radius: 22px; font-weight: 800; margin: 15px 0; font-size: 16px; transition: opacity 0.3s; }
        .save-btn:disabled { opacity: 0.3; cursor: not-allowed; filter: grayscale(1); }

        .field-error { color: var(--error); font-size: 10px; font-weight: 900; text-align: center; margin-top: 5px; text-transform: uppercase; height: 12px; }
        #log-list { margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; }
        .log-item { background: rgba(255,255,255,0.05); padding: 14px; border-radius: 18px; margin-bottom: 8px; border-left: 5px solid var(--primary); cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .del-log { color: var(--error); background: rgba(239, 68, 68, 0.1); border: none; width: 26px; height: 26px; border-radius: 8px; font-weight: 900; }
        
        /* MODALLAR */
        #receipt-modal, #warning-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
        .receipt-content { background: white; color: black; width: 100%; max-width: 340px; border-radius: 8px; padding: 25px; font-family: 'Courier New', monospace; }
        .warning-content { background: #1e293b; color: white; width: 100%; max-width: 340px; border-radius: 20px; padding: 25px; border: 2px solid var(--error); }
        .temp-unit-wrap { position: relative; display: flex; align-items: center; background: rgba(0,0,0,0.2); border-radius: 10px; height: 36px; padding: 0 8px; }
        .temp-symbol { font-size: 10px; font-weight: 800; color: var(--temp-clr); margin-right: 4px; opacity: 0.8; }
        .fleet-brand-svg { width: 60px; height: 60px; fill: var(--primary); }
    </style>
</head>
<body>

    <div id="entry-page" class="page" style="display: flex;">
        <div class="hero-section">
            <div id="main-app-logo" class="brand-svg-container"></div>
            <div class="logo-text"><span class="bold">REFUEL</span><span class="light">ASSIST</span></div>
            <div class="logo-subtitle">Flight Operations Support</div>
            <div class="logo-line"></div>
        </div>
        <div class="fleet-container">
            <div class="fleet-card" onclick="selectFleet('A320 FAMILY', 6230, 6470, 'airbus')">
                <div id="logo-airbus-main"></div>
                <div class="fleet-info">
                    <h2>Airbus A320 Family</h2>
                    <div class="limits">WING: 2 x 6,230 | CTR: 6,470 KG</div>
                    <div class="max-val">MAX CAP: 18,910 KG</div>
                </div>
            </div>
            <div class="fleet-card" onclick="selectFleet('B737 NG/MAX', 3900, 13000, 'boeing')">
                <div id="logo-boeing-main"></div>
                <div class="fleet-info">
                    <h2>Boeing 737 NG/MAX</h2>
                    <div class="limits">WING: 2 x 3,900 | CTR: 13,000 KG</div>
                    <div class="max-val">MAX CAP: 20,800 KG</div>
                </div>
            </div>
        </div>
    </div>

    <div id="calc-page" class="page">
        <div class="card">
            <header class="top-navigation-row">
                <div class="app-logo-indie" onclick="showPage('entry-page')">
                    <div id="logo-header-mini" class="mini-svg-container" style="width:100%; height:100%;"></div>
                </div>
                <div class="expanded-capsule">
                    <div class="model-inner">
                        <div id="brand-mini-logo" class="mini-svg-container" style="width:18px; height:18px;"></div>
                        <span id="active-fleet" class="model-name"></span>
                    </div>
                    <button class="change-model-btn" onclick="showPage('entry-page')">Change Model</button>
                </div>
            </header>

            <div class="action-row">
                <button onclick="showWarnings()" class="warning-btn">‚ö†Ô∏è WARNINGS & PRECAUTIONS</button>
                <button onclick="clearCalculator()" class="reset-btn-amber">RESET</button>
            </div>

            <div id="sec_block" class="input-group">
                <span class="group-label" style="color:var(--primary)">Block Fuel (kg)</span>
                <div style="display:flex; align-items:center; gap:12px"><button class="btn-step" onclick="stepValue('block_fuel', -10)">-</button><input type="number" id="block_fuel" class="main-input" placeholder="0" oninput="validateAll(true)"><button class="btn-step" onclick="stepValue('block_fuel', 10)">+</button></div>
                <div id="err_block" class="field-error"></div>
            </div>
            <div id="sec_actual" class="input-group">
                <span class="group-label" style="color:var(--warning)">Actual FOB (kg)</span>
                <div style="display:flex; align-items:center; gap:12px"><button class="btn-step" style="background:#78350f" onclick="stepValue('total_actual', -10)">-</button><input type="number" id="total_actual" class="main-input" placeholder="0" oninput="validateAll(true)"><button class="btn-step" style="background:#78350f" onclick="stepValue('total_actual', 10)">+</button></div>
                <div id="err_actual" class="field-error"></div>
                <div class="tank-grid">
                    <div class="tank-box"><span style="font-size:8px; color:#94a3b8">LH ACT</span><input type="number" id="la" class="tank-input" oninput="manualActualEntry()"><div style="display:flex; justify-content:space-between"><button class="btn-mini" onclick="stepTank('la',-10)">-</button><button class="btn-mini" onclick="stepTank('la',10)">+</button></div></div>
                    <div class="tank-box"><span style="font-size:8px; color:#94a3b8">CTR ACT</span><input type="number" id="ca" class="tank-input" oninput="manualActualEntry()"><div style="display:flex; justify-content:space-between"><button class="btn-mini" onclick="stepTank('ca',-10)">-</button><button class="btn-mini" onclick="stepTank('ca',10)">+</button></div></div>
                    <div class="tank-box"><span style="font-size:8px; color:#94a3b8">RH ACT</span><input type="number" id="ra" class="tank-input" oninput="manualActualEntry()"><div style="display:flex; justify-content:space-between"><button class="btn-mini" onclick="stepTank('ra',-10)">-</button><button class="btn-mini" onclick="stepTank('ra',10)">+</button></div></div>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="input-group" id="box_density" style="border-color: var(--density-clr); margin-bottom: 0;"><span class="group-label" style="color:var(--density-clr)">Density</span><input type="number" id="density" placeholder="0.800" step="0.001" oninput="validateAll(false)" class="tank-input" style="font-size:22px;"><div id="err_density" class="field-error"></div></div>
                <div id="box_temp" class="input-group" style="border-color: var(--temp-clr); margin-bottom: 0;"><span class="group-label" style="color:var(--temp-clr)">üå°Ô∏è Temp</span><div style="display:flex; gap:6px"><div class="temp-unit-wrap"><span class="temp-symbol">¬∞C</span><input type="number" id="temp_c" placeholder="0" oninput="calcTemp('c')" class="tank-input" style="height:100%"></div><div class="temp-unit-wrap"><span class="temp-symbol">¬∞F</span><input type="number" id="temp_f" placeholder="32" oninput="calcTemp('f')" class="tank-input" style="height:100%"></div></div><div id="err_temp" class="field-error"></div></div>
            </div>
            <div class="dashboard">
                <div class="tank-grid" style="margin-top:0;"><div class="tank-box"><span style="font-size:8px">LH TGT</span><div id="lt" class="tgt-val">0</div><div style="display:flex; justify-content:space-between"><button class="btn-mini" onclick="smartAdjust('lt',-10)">-</button><button class="btn-mini" onclick="smartAdjust('lt',10)">+</button></div></div><div class="tank-box"><span style="font-size:8px">CTR TGT</span><div id="ct" class="tgt-val">0</div><div style="display:flex; justify-content:space-between"><button class="btn-mini" onclick="smartAdjust('ct',-10)">-</button><button class="btn-mini" onclick="smartAdjust('ct',10)">+</button></div></div><div class="tank-box"><span style="font-size:8px">RH TGT</span><div id="rt" class="tgt-val">0</div><div style="display:flex; justify-content:space-between"><button class="btn-mini" onclick="smartAdjust('rt',-10)">-</button><button class="btn-mini" onclick="smartAdjust('rt',10)">+</button></div></div></div>
                <div class="uplift-container"><div style="display:grid; grid-template-columns: 1fr 1fr"><div><div style="font-size:10px; color:#64748b; font-weight:800">UPLIFT KG</div><div id="res_kg" class="val-num" style="color:var(--warning)">0</div></div><div style="border-left: 1px solid rgba(255,255,255,0.1)"><div style="font-size:10px; color:#64748b; font-weight:800">UPLIFT LTR</div><div id="res_lit" class="val-num" style="color:var(--primary)">0</div></div></div></div>
            </div>
            <button id="save-main-btn" class="save-btn" onclick="saveRecord()" disabled>SAVE & VIEW RECEIPT</button>
            <div id="log-list"></div>
        </div>
    </div>

    <div id="receipt-modal"><div class="receipt-content"><h3 style="text-align:center; border-bottom:2px dashed #000; padding-bottom:12px; margin-top:0">REFUEL RECEIPT</h3><div id="r-details" style="font-size:13px; line-height:1.6"></div><button onclick="document.getElementById('receipt-modal').style.display='none'" style="width:100%; background:#000; color:#fff; border:none; padding:18px; margin-top:20px; font-weight:800; border-radius:6px; cursor:pointer">CLOSE</button></div></div>

    <div id="warning-modal">
        <div class="warning-content">
            <h3 style="color:var(--error); margin-top:0; text-align:center">PRECAUTIONS</h3>
            <ul style="font-size:12px; padding-left:20px; line-height:1.6">
                <li>Always verify actual density from the fuel bill.</li>
                <li><b>WING FIRST:</b> Ensure wings are balanced and filled before center tank.</li>
                <li>Check tank limits for the selected aircraft model.</li>
                <li>Maintain 3% reserve during calculation when required.</li>
                <li>Ensure ground equipment grounding before refuel.</li>
            </ul>
            <button onclick="document.getElementById('warning-modal').style.display='none'" style="width:100%; background:var(--error); color:#fff; border:none; padding:15px; margin-top:10px; font-weight:800; border-radius:12px; cursor:pointer">I UNDERSTAND</button>
        </div>
    </div>

<script>
    const APP_LOGO_SVG = `<svg viewBox="0 0 652 652" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet"><g transform="translate(0,652) scale(0.1,-0.1)"><path d="M3224 5676 c14 -30 26 -60 26 -67 0 -6 9 -28 19 -48 11 -20 28 -56 39 -81 11 -25 32 -71 46 -102 14 -31 26 -62 26 -69 0 -12 63 -149 115 -249 12 -25 26 -60 30 -77 3 -18 10 -33 15 -33 5 0 14 -17 21 -37 6 -20 26 -65 44 -99 36 -68 65 -148 65 -176 0 -10 -7 -21 -15 -24 -8 -4 -88 15 -177 41 -90 27 -197 53 -238 60 -91 14 -251 52 -303 71 -20 8 -50 14 -65 14 -16 0 -36 6 -46 13 -17 12 -17 17 -3 63 8 27 30 83 50 124 19 41 38 86 42 100 4 14 16 35 25 47 10 13 21 40 25 60 4 20 13 46 21 57 8 12 19 39 25 61 6 22 17 47 24 55 7 8 18 33 25 55 7 22 19 49 25 60 7 11 18 43 25 72 6 28 18 60 25 70 8 10 15 26 15 36 0 27 19 57 35 57 7 0 25 -24 39 -54z m2096 -946 c12 -7 88 -16 169 -21 80 -5 155 -11 166 -14 32 -7 65 -61 72 -115 5 -43 2 -56 -20 -89 -24 -36 -66 -80 -129 -136 -26 -23 -167 -95 -185 -95 -7 0 -13 -4 -13 -9 0 -5 -22 -17 -49 -26 -27 -9 -55 -23 -61 -31 -7 -7 -18 -14 -25 -14 -12 0 -101 -40 -135 -61 -8 -5 -31 -16 -50 -25 -37 -16 -78 -35 -221 -103 -48 -23 -92 -41 -98 -41 -7 0 -29 -9 -49 -19 -78 -41 -142 -71 -153 -71 -6 0 -23 -8 -37 -19 -15 -10 -40 -21 -55 -25 -67 -16 -95 -47 -158 -171 -78 -154 -94 -183 -112 -203 -8 -9 -18 -28 -22 -42 -4 -14 -16 -36 -26 -49 -11 -13 -19 -31 -19 -40 0 -10 -8 -26 -18 -37 -9 -10 -23 -30 -30 -44 -7 -14 -27 -47 -43 -75 -16 -27 -39 -70 -50 -95 -12 -24 -28 -50 -35 -58 -8 -7 -14 -20 -14 -27 0 -7 -11 -27 -25 -43 -14 -17 -25 -36 -25 -44 0 -8 -9 -23 -19 -32 -11 -10 -22 -29 -26 -43 -3 -15 -15 -38 -26 -51 -10 -14 -19 -30 -19 -37 0 -6 -9 -20 -19 -29 -11 -10 -22 -29 -26 -43 -3 -14 -14 -37 -24 -52 -34 -49 -56 -86 -68 -113 -7 -16 -18 -28 -26 -28 -8 0 -22 -9 -31 -19 -10 -11 -31 -23 -47 -26 -15 -4 -39 -15 -51 -25 -13 -10 -42 -23 -65 -29 -23 -6 -45 -16 -48 -21 -3 -6 -17 -10 -30 -10 -13 0 -37 -8 -54 -17 -20 -12 -33 -14 -39 -8 -11 13 3 159 25 245 9 36 20 88 26 115 5 28 16 73 23 100 26 94 73 300 79 344 3 25 12 65 21 90 25 79 33 139 20 157 -15 20 -75 11 -107 -17 -12 -10 -27 -19 -33 -19 -6 0 -28 -9 -49 -20 -20 -11 -43 -20 -51 -20 -7 0 -24 -8 -37 -19 -13 -10 -35 -22 -49 -26 -14 -4 -66 -27 -116 -51 -50 -24 -97 -44 -105 -44 -8 0 -32 -11 -54 -25 -22 -13 -49 -25 -60 -25 -11 0 -42 -12 -70 -25 -27 -14 -56 -25 -63 -25 -7 0 -30 -9 -52 -20 -22 -11 -47 -20 -57 -20 -10 0 -35 -9 -56 -20 -33 -18 -56 -20 -199 -20 -90 0 -179 3 -200 6 -35 6 -73 35 -113 89 -25 33 -303 315 -368 373 -27 24 -56 60 -64 80 -14 34 -14 37 7 54 12 10 28 18 35 18 7 0 18 7 25 15 7 8 27 17 46 21 18 3 38 12 45 20 15 18 66 18 101 0 14 -8 42 -19 61 -25 20 -7 41 -19 47 -27 7 -7 21 -14 32 -14 10 0 -36 -8 56 -19 225 -113 246 -122 307 -121 41 0 70 6 91 19 17 10 45 22 62 26 18 3 34 10 37 15 9 14 125 69 161 76 18 3 38 12 44 19 6 8 24 17 40 20 16 3 34 12 40 20 6 8 24 17 40 20 16 3 34 13 41 21 6 8 17 14 23 14 6 0 28 9 49 20 20 11 44 20 53 20 9 0 27 9 41 20 14 11 33 20 43 20 10 0 28 9 42 19 13 11 37 23 51 26 15 4 30 11 33 16 2 5 24 14 47 20 47 12 57 22 50 50 -8 30 -224 169 -263 169 -4 0 -10 7 -14 15 -3 8 -10 15 -16 15 -9 0 -96 55 -126 79 -6 5 -45 26 -85 45 -41 20 -92 50 -114 67 -22 16 -58 39 -80 50 -22 10 -58 30 -80 44 -22 13 -50 30 -63 36 -33 18 -25 51 14 64 17 6 37 15 45 21 8 7 30 15 49 19 19 4 42 13 50 20 8 7 31 16 50 20 19 4 46 14 60 23 29 20 99 41 155 49 45 6 166 -13 210 -33 41 -19 168 -53 240 -65 34 -5 110 -23 170 -40 61 -17 146 -39 190 -50 106 -27 220 -58 275 -76 128 -41 234 -46 288 -13 18 11 41 20 50 20 10 0 33 11 52 25 19 14 41 25 51 25 9 0 27 9 41 19 13 11 38 23 54 27 16 4 40 15 53 26 13 10 30 18 38 18 8 0 38 12 67 26 111 58 125 64 139 64 8 0 24 9 37 20 13 11 30 20 39 20 9 0 35 9 56 21 22 11 61 27 88 35 26 8 47 19 47 23 0 29 210 38 260 11z m-2646 -634 c37 -25 109 -66 161 -92 96 -48 112 -65 103 -111 -3 -18 -57 -49 -183 -104 -38 -17 -94 -42 -123 -55 -29 -13 -58 -24 -66 -24 -7 0 -24 -9 -38 -19 -25 -20 -135 -61 -164 -61 -12 0 -15 6 -10 23 4 12 11 43 17 69 6 26 17 52 25 59 8 6 14 18 14 26 0 8 11 35 25 61 14 26 25 56 25 68 0 12 7 27 15 34 8 7 17 28 20 49 3 20 15 55 27 79 18 37 25 42 54 42 22 0 54 -14 98 -44z m1604 -914 c7 -5 19 -30 26 -58 8 -27 21 -69 29 -94 8 -25 24 -79 36 -120 12 -41 27 -88 33 -105 5 -16 17 -55 24 -85 8 -30 21 -75 29 -100 15 -44 28 -127 42 -258 13 -133 -40 -461 -84 -513 -6 -8 -15 -28 -19 -44 -7 -29 -24 -68 -57 -130 -9 -16 -23 -44 -31 -61 -8 -17 -22 -36 -30 -44 -9 -7 -16 -18 -16 -26 0 -14 -191 -211 -230 -237 -14 -9 -44 -30 -68 -47 -24 -16 -57 -37 -75 -45 -18 -8 -57 -29 -87 -46 -61 -33 -227 -89 -269 -89 -14 0 -63 -9 -109 -20 -89 -21 -182 -25 -247 -10 -22 5 -69 16 -105 24 -77 18 -147 47 -179 75 -13 11 -26 21 -30 23 -11 5 -71 91 -71 103 0 6 -11 26 -25 45 -14 19 -25 41 -25 49 0 8 -7 22 -15 31 -56 62 -52 531 5 638 11 20 20 45 20 54 0 10 9 35 20 55 11 21 20 46 20 55 0 32 97 235 140 293 16 22 39 56 50 75 72 122 131 200 152 200 17 0 19 -5 15 -37 -16 -116 -39 -236 -53 -274 -8 -24 -20 -84 -25 -133 -5 -49 -16 -109 -23 -135 -32 -103 -45 -155 -40 -163 7 -11 48 -10 59 1 6 5 48 23 95 41 47 17 102 40 122 51 20 10 42 19 48 19 6 0 41 14 78 31 37 17 85 39 107 49 22 10 61 28 86 39 25 12 51 21 56 21 5 0 18 9 28 20 10 11 23 20 29 20 16 0 61 60 101 133 35 63 56 100 100 172 13 22 36 63 51 90 16 28 36 64 45 80 10 17 27 48 38 70 12 22 34 60 50 85 30 45 89 160 110 213 11 27 41 36 69 19z m-1178 -158 c0 -3 -15 -25 -32 -47 -18 -23 -37 -49 -43 -58 -15 -25 -101 -147 -141 -199 -19 -25 -39 -56 -45 -70 -6 -14 -15 -32 -20 -40 -5 -8 -14 -26 -20 -40 -6 -14 -18 -36 -26 -50 -8 -14 -21 -41 -30 -60 -8 -19 -18 -37 -22 -40 -14 -11 -61 -112 -67 -147 -4 -21 -15 -56 -25 -78 -10 -22 -19 -51 -19 -64 0 -13 -11 -47 -24 -75 -32 -68 -48 -171 -53 -347 -5 -164 5 -215 74 -394 53 -138 62 -150 183 -255 22 -19 40 -40 40 -46 0 -7 7 -15 16 -18 8 -3 12 -10 9 -16 -4 -6 -13 -7 -23 -1 -9 5 -40 12 -69 16 -28 4 -74 19 -102 33 -108 58 -231 136 -231 147 0 7 -7 18 -15 25 -9 7 -31 40 -51 74 -19 34 -39 68 -44 76 -75 128 -95 276 -65 482 13 91 36 163 90 283 62 136 87 188 95 198 6 7 49 70 96 141 99 150 107 161 267 325 175 179 297 280 297 245z m-495 -211 c-16 -37 -28 -55 -75 -105 -59 -64 -128 -165 -174 -253 -9 -16 -26 -47 -39 -67 -64 -107 -87 -149 -87 -160 0 -8 -8 -29 -19 -48 -10 -19 -21 -52 -25 -74 -4 -21 -15 -57 -25 -80 -22 -48 -50 -156 -63 -241 -19 -124 -44 -145 -78 -68 -22 49 -63 181 -75 243 -3 19 -16 62 -27 95 -18 51 -21 85 -21 235 -1 113 3 189 11 215 7 22 19 72 27 110 13 69 39 156 54 185 9 16 7 16 197 4 84 -5 140 -2 230 11 65 10 126 21 134 26 8 5 27 9 43 9 l27 0 -15 -37z"/></g></svg>`;
    const SVGS = {
        airbus: `<svg class="fleet-brand-svg" viewBox="0 0 1001 1000"><g transform="translate(0,1000) scale(0.1,-0.1)"><path d="M4785 8264 c-698 -55 -1338 -310 -1859 -742 -896 -744 -1328 -1893 -1145 -3046 213 -1336 1245 -2410 2574 -2680 234 -47 363 -60 640 -60 265 -1 367 7 585 45 1221 213 2233 1126 2570 2320 86 306 122 569 122 899 0 658 -178 1255 -536 1800 -525 798 -1363 1319 -2327 1446 -109 14 -520 26 -624 18z m620 -498 c661 -108 1211 -401 1653 -880 386 -418 630 -944 714 -1536 20 -146 17 -585 -5 -730 -79 -509 -266 -946 -577 -1350 -96 -125 -349 -376 -475 -471 -410 -311 -836 -491 -1340 -566 -169 -25 -591 -25 -760 0 -406 60 -771 193 -1102 401 -997 626 -1491 1789 -1252 2947 176 854 782 1606 1584 1967 268 120 548 195 885 236 89 10 579 -3 675 -18z"/><path d="M4990 7503 c-868 -89 -1623 -612 -2005 -1388 -40 -82 -90 -195 -110 -250 -81 -218 -136 -495 -151 -747 l-7 -118 -223 0 -224 0 0 -47 c1 -182 82 -457 191 -648 354 -622 1096 -908 1774 -684 565 186 976 708 1021 1293 l7 86 253 0 254 0 0 -45 c0 -25 -5 -89 -11 -143 -104 -949 -938 -1648 -1888 -1581 -450 31 -844 216 -1162 546 -120 125 -107 97 33 -72 319 -382 788 -633 1301 -696 125 -15 452 -7 565 15 647 121 1170 510 1455 1081 125 252 192 501 212 798 l7 97 249 0 249 0 0 -89 c0 -195 -56 -484 -135 -696 -79 -214 -223 -469 -364 -645 -232 -289 -574 -544 -918 -685 -263 -107 -499 -155 -799 -162 -335 -9 -594 35 -892 149 -309 119 -575 299 -829 561 -70 73 -115 114 -99 92 373 -513 933 -869 1552 -989 199 -38 344 -49 558 -43 211 6 338 23 526 68 1067 260 1856 1212 1907 2302 l6 137 229 0 230 0 -7 68 c-27 277 -109 513 -254 732 -70 106 -239 282 -351 366 -197 147 -443 245 -697 279 -380 51 -779 -52 -1083 -279 -112 -84 -281 -260 -351 -366 -145 -220 -228 -457 -254 -732 l-7 -68 -254 0 -255 0 6 68 c3 37 8 94 11 127 29 331 196 709 433 980 241 277 608 490 968 565 607 125 1231 -72 1659 -523 91 -96 83 -76 -20 53 -531 658 -1448 909 -2244 614 -625 -231 -1090 -748 -1253 -1393 -34 -132 -59 -311 -59 -417 l0 -74 -255 0 -255 0 0 58 c0 98 20 271 47 402 139 687 605 1287 1240 1596 866 422 1912 250 2594 -426 64 -63 135 -137 159 -165 55 -64 42 -43 -46 70 -410 533 -1014 877 -1684 960 -113 14 -447 19 -550 8z"/></g></svg>`,
        boeing: `<svg class="fleet-brand-svg" viewBox="0 0 1100 1100"><g transform="translate(50, 80)"><path d="M289.2,180.5C131,180.5,2.5,308.7,2.5,466.9s128.3,286.7,286.7,286.7s286.7-128.3,286.7-286.7 S447.3,180.5,289.2,180.5z M289.2,716.4C149.7,716.2,36.7,604.3,36.7,466.9s113.1-249.4,252.5-249.4s252.5,111.9,252.5,249.4 C541.7,604.8,428.6,716.4,289.2,716.4z"/><path d="M997.4,670l-497.9,20.3L395.4,493.8C587,679.6,1004.3,647.1,997.4,670L997.4,670z M114,834.8 c-35.5-31.4-10.9-134.6,72-271.5C358.6,277.8,595.6,89.7,595.6,89.7c-181.5,108.8-284.9,217.7-372.9,326 C41.3,638.8-18.1,849.2,58.5,902.8c32.4,22.8,142.7-2,230.7-135.3C239.5,812.1,153,868.9,114,834.4L114,834.8z"/></g></svg>`
    };

    let LW, LC, fleet;
    document.getElementById('main-app-logo').innerHTML = APP_LOGO_SVG;
    document.getElementById('logo-header-mini').innerHTML = APP_LOGO_SVG;
    document.getElementById('logo-airbus-main').innerHTML = SVGS.airbus;
    document.getElementById('logo-boeing-main').innerHTML = SVGS.boeing;

    function showPage(id) { document.querySelectorAll('.page').forEach(p => p.style.display = 'none'); document.getElementById(id).style.display = (id === 'entry-page') ? 'flex' : 'block'; if(id==='calc-page') renderLogs(); }
    function selectFleet(n, w, c, brand) { fleet=n; LW=w; LC=c; document.getElementById('active-fleet').innerText=n.toUpperCase(); document.getElementById('brand-mini-logo').innerHTML = SVGS[brand]; showPage('calc-page'); validateAll(true); }
    function stepValue(id, v) { let el=document.getElementById(id); el.value=Math.max(0, (parseFloat(el.value)||0)+v); validateAll(true); }
    function stepTank(id, v) { let el=document.getElementById(id); let limit=(id==='ca')?LC:LW; el.value=Math.max(0, Math.min(limit, (parseFloat(el.value)||0)+v)); manualActualEntry(); }
    
    function manualActualEntry() {
        let bV = Math.max(0, parseFloat(document.getElementById('block_fuel').value) || 0);
        let l = parseFloat(document.getElementById('la').value) || 0;
        let c = parseFloat(document.getElementById('ca').value) || 0;
        let r = parseFloat(document.getElementById('ra').value) || 0;
        l = Math.min(LW, l); r = Math.min(LW, r); c = Math.min(LC, c);
        let currentTotal = l + c + r;
        if (currentTotal > bV && bV > 0) {
            let overflow = currentTotal - bV;
            if (c >= overflow) { c -= overflow; } 
            else { overflow -= c; c = 0; let half = overflow / 2; l -= half; r -= half; }
        }
        document.getElementById('la').value = Math.max(0, l);
        document.getElementById('ra').value = Math.max(0, r);
        document.getElementById('ca').value = Math.max(0, c);
        document.getElementById('total_actual').value = Math.max(0, l + c + r);
        validateAll(false);
    }

    function showWarnings() { document.getElementById('warning-modal').style.display = 'flex'; }
    
    function calcTemp(s) { 
        const c = document.getElementById('temp_c'), f = document.getElementById('temp_f'); 
        let v; 
        if(s==='c'){ 
            v = parseFloat(c.value); 
            f.value = c.value!==''?Math.round((v*9/5)+32):''; 
        } else { 
            v = Math.round((parseFloat(f.value)-32)*5/9); 
            c.value = f.value!==''? v : ''; 
        }
        validateAll(false);
    }

    function clearCalculator() { ['block_fuel','total_actual','la','ca','ra','density','temp_c','temp_f'].forEach(id => { if(document.getElementById(id)) document.getElementById(id).value = ''; }); validateAll(true); }

    function validateAll(auto = false) {
        let bV = Math.max(0, parseFloat(document.getElementById('block_fuel').value) || 0);
        let aV = Math.max(0, parseFloat(document.getElementById('total_actual').value) || 0);
        let dV = parseFloat(document.getElementById('density').value) || 0;
        let tV = parseFloat(document.getElementById('temp_c').value);
        const laV = parseFloat(document.getElementById('la').value) || 0;
        const caV = parseFloat(document.getElementById('ca').value) || 0;
        const raV = parseFloat(document.getElementById('ra').value) || 0;

        const maxCap = (LW * 2) + LC;
        const secB = document.getElementById('sec_block'), secA = document.getElementById('sec_actual'), boxD = document.getElementById('box_density'), boxT = document.getElementById('box_temp');
        let errB = "", errA = "", errD = "";

        // Temperature Guard Update
        const isTempInvalid = !isNaN(tV) && (tV < -60 || tV > 60);
        if (isTempInvalid) { 
            document.getElementById('err_temp').innerText = "INVALID TEMP"; 
            boxT.style.borderColor = "var(--error)"; 
        } else { 
            document.getElementById('err_temp').innerText = "";
            boxT.style.borderColor = "var(--temp-clr)"; 
        }

        if (bV > maxCap) { bV = maxCap; document.getElementById('block_fuel').value = maxCap; }
        if (bV % 10 !== 0 && bV > 0) { errB = "10KG STEP REQ"; secB.style.borderColor = "var(--error)"; } else { secB.style.borderColor = "var(--primary)"; }
        
        if ((aV % 10 !== 0 && aV > 0) || (laV % 10 !== 0) || (caV % 10 !== 0) || (raV % 10 !== 0)) {
            errA = "10KG STEP REQ (ACT)";
            secA.style.borderColor = "var(--error)";
        } else if (aV > bV && bV > 0) { 
            errA = "ACTUAL > BLOCK"; 
            secA.style.borderColor = "var(--error)"; 
        } else { 
            secA.style.borderColor = "var(--warning)"; 
        }
        
        if (dV > 0 && (dV < 0.6 || dV > 0.9)) { errD = "RANGE 0.6-0.9"; boxD.style.borderColor = "var(--error)"; } 
        else if (dV === 0 && bV > 0) { errD = "DENSITY REQ"; boxD.style.borderColor = "var(--error)"; }
        else { boxD.style.borderColor = "var(--density-clr)"; }

        document.getElementById('err_block').innerText = errB; document.getElementById('err_actual').innerText = errA; document.getElementById('err_density').innerText = errD;

        if(auto && !errB && !errA) {
            // UPDATED TARGET CALCULATION LOGIC
            let ltVal, rtVal, ctVal;
            const wMaxTotal = LW * 2;
            
            if (bV <= wMaxTotal) {
                // Symmetrical wing fill first
                ltVal = Math.round((bV / 2) / 10) * 10;
                rtVal = bV - ltVal;
                ctVal = 0;
            } else {
                // Wings full, rest to center
                ltVal = LW;
                rtVal = LW;
                ctVal = bV - wMaxTotal;
            }
            
            document.getElementById('lt').innerText = ltVal; 
            document.getElementById('rt').innerText = rtVal; 
            document.getElementById('ct').innerText = ctVal;
        }

        let currentTgtTotal = parseInt(document.getElementById('lt').innerText) + parseInt(document.getElementById('rt').innerText) + parseInt(document.getElementById('ct').innerText);
        let resK = Math.max(0, currentTgtTotal - aV);
        document.getElementById('res_kg').innerText = resK.toLocaleString();
        
        let litVal = (dV >= 0.6 && dV <= 0.9 && resK > 0) ? Math.round(resK / dV) : 0;
        document.getElementById('res_lit').innerText = litVal.toLocaleString();

        document.getElementById('save-main-btn').disabled = (resK <= 0 || dV < 0.6 || dV > 0.9 || errB !== "" || errA !== "" || isTempInvalid);
    }

    function smartAdjust(id, v) {
        let bV = Math.max(0, parseFloat(document.getElementById('block_fuel').value) || 0);
        if (bV <= 0) return;
        
        let lt = parseInt(document.getElementById('lt').innerText);
        let rt = parseInt(document.getElementById('rt').innerText);
        let ct = parseInt(document.getElementById('ct').innerText);
        
        // HARD LIMITS & LOGIC
        if (v > 0) {
            let available = bV - (lt + rt + ct);
            let toAdd = Math.min(v, available);
            if (toAdd > 0) {
                if (id === 'ct') ct = Math.min(LC, ct + toAdd);
                else if (id === 'lt') lt = Math.min(LW, lt + toAdd);
                else if (id === 'rt') rt = Math.min(LW, rt + toAdd);
            }
        } else {
            let toSub = Math.abs(v);
            if (id === 'ct') ct = Math.max(0, ct - toSub);
            else if (id === 'lt') lt = Math.max(0, lt - toSub);
            else if (id === 'rt') rt = Math.max(0, rt - toSub);
            
            // Re-balance to maintain Block Total if manually decreased
            let missing = bV - (lt + rt + ct);
            if (missing > 0) {
                // Simple logic to put manual reduction back into other tanks to keep total constant
                if (id !== 'ct' && ct < LC) {
                    let move = Math.min(missing, LC - ct);
                    ct += move; missing -= move;
                }
                if (missing > 0 && id !== 'lt' && lt < LW) {
                    let move = Math.min(missing, LW - lt);
                    lt += move; missing -= move;
                }
                if (missing > 0 && id !== 'rt' && rt < LW) {
                    let move = Math.min(missing, LW - rt);
                    rt += move;
                }
            }
        }

        document.getElementById('lt').innerText = Math.round(lt);
        document.getElementById('rt').innerText = Math.round(rt);
        document.getElementById('ct').innerText = Math.round(ct);
        validateAll(false);
    }

    function saveRecord() {
        const rec = { id: Date.now(), fleet: fleet, time: new Date().toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'}), date: new Date().toLocaleDateString('tr-TR'), block: document.getElementById('block_fuel').value, dens: document.getElementById('density').value, tempC: document.getElementById('temp_c').value, act_total: document.getElementById('total_actual').value, act_l: document.getElementById('la').value, act_c: document.getElementById('ca').value, act_r: document.getElementById('ra').value, tgt_l: document.getElementById('lt').innerText, tgt_c: document.getElementById('ct').innerText, tgt_r: document.getElementById('rt').innerText, kg: document.getElementById('res_kg').innerText, lt: document.getElementById('res_lit').innerText };
        let logs = JSON.parse(localStorage.getItem('logs_v6') || '[]');
        logs.unshift(rec); localStorage.setItem('logs_v6', JSON.stringify(logs.slice(0,10)));
        renderLogs(); openReceipt(rec);
    }

    function renderLogs() {
        const list = document.getElementById('log-list');
        let logs = JSON.parse(localStorage.getItem('logs_v6') || '[]');
        if(logs.length === 0) { list.innerHTML = ''; return; }
        list.innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center; margin:15px 0 10px"><span style="font-size:11px; font-weight:900; color:#64748b; letter-spacing:1px">RECENT LOGS</span><button onclick="clearAllLogs()" style="color:var(--error); background:none; border:none; font-size:10px; font-weight:800; cursor:pointer">CLEAR ALL</button></div>`;
        logs.forEach(log => {
            const div = document.createElement('div'); div.className = 'log-item';
            div.innerHTML = `<div onclick="openReceiptById(${log.id})" style="flex-grow:1; display:flex; justify-content:space-between; align-items:center"><span><b>${log.fleet}</b></span><span><b style="color:var(--warning)">${log.kg} KG</b> <small style="opacity:0.5; margin-left:8px">${log.time}</small></span></div><button class="del-log" onclick="deleteLog(${log.id})">√ó</button>`;
            list.appendChild(div);
        });
    }

    function deleteLog(id) { let logs = JSON.parse(localStorage.getItem('logs_v6') || '[]'); logs = logs.filter(l => l.id !== id); localStorage.setItem('logs_v6', JSON.stringify(logs)); renderLogs(); }
    function clearAllLogs() { if(confirm('Delete all history?')) { localStorage.removeItem('logs_v6'); renderLogs(); } }
    function openReceiptById(id) { let logs = JSON.parse(localStorage.getItem('logs_v6') || '[]'); let log = logs.find(l => l.id === id); if(log) openReceipt(log); }
    function openReceipt(log) { 
        document.getElementById('r-details').innerHTML = `<b>DATE:</b> ${log.date} ${log.time}<br><b>FLEET:</b> ${log.fleet}<br><b>DENSITY:</b> ${log.dens || '---'} | <b>TEMP:</b> ${log.tempC || '---'}¬∞C<br><hr style="border:0; border-top:1px dashed #000; margin:10px 0"><b>BLOCK FUEL:</b> ${log.block} KG<br><b>ACTUAL FOB:</b> ${log.act_total} KG<br><small>(LH:${log.act_l} | CTR:${log.act_c} | RH:${log.act_r})</small><br><hr style="border:0; border-top:1px dashed #000; margin:10px 0"><b>TARGET VALUES:</b><br>LH: ${log.tgt_l} | CTR: ${log.tgt_c} | RH: ${log.tgt_r} KG<br><hr style="border:0; border-top:2px solid #000; margin:10px 0"><div style="font-size:16px; font-weight:900">UPLIFT KG: ${log.kg}<br>UPLIFT LTR: ${log.lt}</div>`; 
        document.getElementById('receipt-modal').style.display = 'flex'; 
    }
</script>
</body>
</html>
